# Step By Step Component Examples

This page provides step-by-step examples of how to create components for the Embeddable Builder. Each example includes both the React component code and the corresponding `.emb.ts` file that defines the component's metadata, inputs, and configuration.

## A Simple Data Component Example

Below is a simple **KPI chart** component that loads data from your database:

```tsx
// src/components/KPIChart/index.tsx

import React from 'react';
import { DataResponse, Measure } from '@embeddable.com/core';
import Loading from '../util/Loading'
import Error from '../util/Error'

type Props = {
  title?: string;
  metric?: Measure; // { name, title }
  results: DataResponse; // { isLoading, error, data: [{ <name>: <value>, ... }]
};

export default ({ title, metric, results }: Props) => {

  const { isLoading, data, error } = results;

  if(isLoading) {
    return <Loading />
  }

  if(error) {
    return <Error msg={error}/>;
  }

  const value = results.data?.[0]?.[metric.name] ?? 'No data';

  return (
    <div>
      {title && <h1>{title}</h1>}
      <p>{value}</p>
    </div>
  );
};
```

And its `.emb` file, defining the **inputs** and **configuration**:

```tsx
// src/components/KPIChart/KPIChart.emb.ts

import { EmbeddedComponentMeta, defineComponent, Inputs } from '@embeddable.com/react';
import { loadData } from '@embeddable.com/core';
import Component from './index';

export const meta = {
  name: 'KPIChart', // an identifier - must match KPIChart.emb.ts
  label: 'KPI Chart', // user-facing name in the builder 
  inputs: [
    {
      name: 'title',
      type: 'string',
      label: 'Title text',
    },
    {
      name: 'ds',
      type: 'dataset', // shows a dropdown of available datasets. These are created directly in the Builder.
      label: 'Dataset',
    },
    {
      name: 'metric',
      type: 'measure', // shows a dropdown of measures (defined in your data models)
      label: 'KPI',
      array: false, // specifies that users can select a single measure 
      config: {
        dataset: 'ds', // restricts measure options to the selected dataset
      }
    },
  ]
} as const satisfies EmbeddedComponentMeta;

//The function that tells the SDK to include this component in the no-code builder.
export default defineComponent(Component, meta, {
  props: (inputs: Inputs<typeof meta>) => {
    return {
      ...inputs, // the inputs are passed through to the component as props
      results: loadData({ // fetches data from your database and passes it to your component
        from: inputs.ds,
        measures: [inputs.metric], 
      })
    };
  }
});
```
## Defining the Meta for a Buttons Component

```ts
// src/components/Buttons/Buttons.emb.ts

import { Value } from '@embeddable.com/core';
import { EmbeddedComponentMeta, Inputs, defineComponent } from '@embeddable.com/react';

import Component from './index';

export const meta = {
  name: 'Buttons', // Must match the .emb.ts filename; unique ID for this component
  label: 'Button List', // User-facing name in the builder UI
  defaultWidth: 400, // Initial width in pixels when dropped on the canvas
  defaultHeight: 80, // Initial height in pixels when dropped on the canvas
  category: 'Controls: buttons', // Optional grouping/category in the builder
  
  inputs: [
    {
      name: 'values',
      type: 'string',
      array: true, // Allows multiple string values (multi-select)
      label: 'Values',
      category: 'Button values' // Groups these inputs in the builder UI
    },
    {
      name: 'title',
      type: 'string',
      label: 'Title',
      category: 'Settings' // Another input category for organizational purposes
    },
    {
      name: 'selectedValues',
      type: 'string',
      array: true,
      label: 'Default value',
      category: 'Pre-configured variables'
    }
  ],

  events: [
    {
      name: 'onChange', // Event name your React component expects as a prop
      label: 'Change', // How this event appears in the builder UI when defining interactions
      properties: [
        {
          name: 'value', // The property name to be passed back
          type: 'string',
          array: true // Indicates multiple string values can be returned
        }
      ]
    }
  ],

  variables: [
    {
      name: 'chosen value', // Variable created automatically when this component is added
      type: 'string',
      array: true,
      defaultValue: Value.noFilter(), // Initial variable value (if none provided)
      inputs: ['selectedValues'], // Connects the variable to the 'selectedValues' input
      events: [{ name: 'onChange', property: 'value' }] // On the 'onChange' event, update the 'chosen value' variable with the 'value' property from the event
    }
  ]
} as const satisfies EmbeddedComponentMeta;

export default defineComponent(Component, meta, {
  props: (inputs: Inputs<typeof meta>, [state], clientContext) => {
    // Maps the inputs defined in meta to the props of your React component
    return {
      ...inputs,
      clientContext // e.g. { theme: 'dark', locale: 'en-US' }
    };
  },
  events: {
    // Maps the 'onChange' event from your React component to an event described in meta
    onChange: (v) => ({ value: v || Value.noFilter() })
  }
});
```
## Adding Sub-Inputs to Existing Components Example

**Simplified Table Component .emb.ts File With Sub-Inputs**
```tsx
import {
  Dimension,
  Measure,
  OrderBy,
  isDimension,
  isMeasure,
  loadData,
} from "@embeddable.com/core";
import {
  EmbeddedComponentMeta,
  Inputs,
  defineComponent,
} from "@embeddable.com/react";

import Component, { Props } from "./index";

export const meta = {
  name: "TableChart",
  label: "Table",
  defaultHeight: 300,
  defaultWidth: 900,
  classNames: ["inside-card"],
  category: "Charts: essentials",
  // These are the top-level inputs that will be displayed in the no-code builder
  inputs: [
    {
      name: "ds",
      type: "dataset",
      label: "Dataset to display",
      description: "Dataset",
      defaultValue: false,
      category: "Chart data",
    },
    {
      name: "columns",
      type: "dimensionOrMeasure",
      label: "Columns",
      array: true,
      // These sub-inputs will also be displayed as expandable inputs in the no-code builder
      inputs: [
        {
          name: "label",
          type: "string",
          label: "Label name",
          description: "The label to show on this column",
          required: false,
        },
        {
          name: "suffix",
          type: "string",
          supportedTypes: ["number", "string"],
          label: "Suffix",
        },
      ],
      config: {
        dataset: "ds",
      },
      category: "Chart data",
    },
    // Chart settings
    {
      name: "title",
      type: "string",
      label: "Title",
      category: "Chart settings",
    },
    {
      name: "description",
      type: "string",
      label: "Description",
      description: "The description for the chart",
      category: "Chart settings",
    },
  ],
} as const satisfies EmbeddedComponentMeta;

export default defineComponent<
  Props,
  typeof meta,
  {
    downloadAll: boolean;
    maxRowsFit: number;
    page: number;
    prevVariableValues: Record<string, any>;
    sort: OrderBy[];
  }
>(Component, meta, {
  props: (inputs: Inputs<typeof meta>, [state]) => {
    const currVariableValues = inputs?.ds?.variableValues || {};
    const prevVariableValues = state?.prevVariableValues || {};

    const results = loadData({
      from: inputs.ds,
      dimensions:
        (inputs.columns?.filter((c) => isDimension(c)) as Dimension[]) || [],
      measures:
        (inputs.columns?.filter((c) => isMeasure(c)) as Measure[]) || [],
      limit: 1000,
    });

    return {
      ...inputs,
      results,
    };
  },
});
```

**Simplified Table Component index.tsx File Using Sub-Inputs**

```tsx
import { DataResponse, DimensionOrMeasure } from '@embeddable.com/core';
import { useTheme } from '@embeddable.com/react';

import Container from '../../Container';
import { Theme } from '../../../../themes/theme';

export type Props = {
  columns: DimensionOrMeasure[];
  results: DataResponse;
  title: string;
};

function formatColumn(text: string | number, column: DimensionOrMeasure) {
  // Note that we check the suffix sub-input below
  return `${text} ${column.inputs?.suffix || ''}`.trim();
}

const TableHead = ({ columns }: { columns: DimensionOrMeasure[] }) => {
  return (
    <thead className={`border-y border-[color:--embeddable-controls-borders-colors-primary]`}>
      <tr>
        {columns.map((column) => {
          return (
            <th
              key={column.name}
              className={`
                cursor-pointer
                p-3
                select-none
                bg-[color:--embeddable-controls-backgrounds-colors-soft]
              `}
            >
              <div className="flex items-center gap-1 hover:text-black">
                <span className="embeddable-table-header mr-1 truncate">
                  {/* Note that we check the label sub-input below */}
                  {column.inputs ? column.inputs?.label : column.name}
                </span>
              </div>
            </th>
          );
        })}
      </tr>
    </thead>
  );
};

export default (props: Props) => {
  const { columns, results } = props;

  const theme: Theme = useTheme() as Theme;

  return (
    <Container {...props} childContainerClassName="overflow-x-auto" className="overflow-y-auto">
      <div>
        {!(props.results?.isLoading && !props.results?.data?.length) && (
          <table className="overflow-visible w-full" style={{ fontSize: theme.font.size }}>
            <TableHead columns={columns} />

            <tbody>
              {results?.data?.map((row, index) => (
                <tr key={index} className="hover:bg-gray-400/5">
                  {columns.map((column, index) => (
                    <td
                      key={index}
                      className="text-dark p-3 truncate"
                      style={{
                        fontSize: theme.font.size,
                        maxWidth: 'auto',
                      }}
                    >
                      <span title={formatColumn(row[column.name], column) ?? ''}>
                        {formatColumn(row[column.name], column)}
                      </span>
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </Container>
  );
};
```

